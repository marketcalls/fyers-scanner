{% extends "base.html" %}

{% block title %}Scan {{ watchlist.name }} - Fyers Scanner{% endblock %}

{% block content %}
<div class="container" style="padding-top: 2rem; padding-bottom: 4rem; max-width: 900px;">
    <div style="margin-bottom: 2rem;">
        <a href="/watchlist/{{ watchlist.id }}" class="text-secondary" style="font-size: 0.875rem; text-decoration: none;">← Back to Watchlist</a>
        <h1 style="font-size: 2.5rem; font-weight: 700; margin-top: 0.5rem; margin-bottom: 0.5rem;">
            Scan: <span class="text-accent">{{ watchlist.name }}</span>
        </h1>
        <p class="text-secondary">Configure and run your EMA crossover scan</p>
    </div>

    <!-- Scanner Info -->
    <div class="alert alert-info" style="margin-bottom: 2rem;">
        <div>
            <strong style="font-size: 1rem;">⚡ EMA Crossover Scanner</strong>
            <p style="margin-top: 0.5rem; font-size: 0.875rem;">This scanner detects 10 EMA and 20 EMA crossovers for intraday trading signals.</p>
            <ul style="margin-top: 0.75rem; padding-left: 1.5rem; font-size: 0.875rem; line-height: 1.8;">
                <li><strong style="color: var(--success-green);">BUY Signal:</strong> 10 EMA crosses above 20 EMA (Bullish crossover)</li>
                <li><strong style="color: var(--error-red);">SELL Signal:</strong> 10 EMA crosses below 20 EMA (Bearish crossover)</li>
                <li><strong>NEUTRAL:</strong> No crossover detected</li>
            </ul>
        </div>
    </div>

    <!-- Watchlist Info Card -->
    <div class="card" style="margin-bottom: 2rem;">
        <div class="stat-label">Watchlist</div>
        <div class="stat-value" style="font-size: 1.5rem;">{{ watchlist.name }}</div>
        <div class="stat-desc">{{ watchlist.symbols|length }} symbols to scan</div>
    </div>

    {% if watchlist.symbols|length == 0 %}
    <div class="alert alert-warning">
        <div>
            <strong>⚠</strong>
            <span>This watchlist is empty. Please add symbols before running a scan.</span>
        </div>
    </div>
    <div style="margin-top: 1.5rem;">
        <a href="/watchlist/{{ watchlist.id }}" class="btn btn-primary">Add Symbols</a>
    </div>
    {% else %}
    <!-- Scan Configuration -->
    <div class="card">
        <h2 class="card-title">Select Timeframe</h2>
        <p class="text-secondary" style="font-size: 0.875rem; margin-bottom: 1.5rem;">
            Choose the candle timeframe for analysis
        </p>

        <form method="post" action="/scan/{{ watchlist.id }}/run">
            <div class="grid grid-cols-3" style="margin-bottom: 2rem;">
                <label class="card" style="cursor: pointer; padding: 1.5rem; text-align: center;">
                    <input type="radio" name="timeframe" value="5" checked style="display: none;" class="timeframe-radio">
                    <div class="timeframe-option">
                        <div style="font-size: 2rem; font-weight: 700; color: var(--accent-green); margin-bottom: 0.5rem;">5</div>
                        <div class="text-secondary">Minutes</div>
                    </div>
                </label>
                <label class="card" style="cursor: pointer; padding: 1.5rem; text-align: center;">
                    <input type="radio" name="timeframe" value="10" style="display: none;" class="timeframe-radio">
                    <div class="timeframe-option">
                        <div style="font-size: 2rem; font-weight: 700; color: var(--accent-green); margin-bottom: 0.5rem;">10</div>
                        <div class="text-secondary">Minutes</div>
                    </div>
                </label>
                <label class="card" style="cursor: pointer; padding: 1.5rem; text-align: center;">
                    <input type="radio" name="timeframe" value="15" style="display: none;" class="timeframe-radio">
                    <div class="timeframe-option">
                        <div style="font-size: 2rem; font-weight: 700; color: var(--accent-green); margin-bottom: 0.5rem;">15</div>
                        <div class="text-secondary">Minutes</div>
                    </div>
                </label>
            </div>

            <button type="submit" class="btn btn-primary" style="width: 100%; padding: 1rem; font-size: 1.125rem; display: flex; align-items: center; justify-content: center; gap: 0.5rem;">
                <span style="font-size: 1.5rem;">⚡</span>
                <span>Start Scanning</span>
            </button>
        </form>
    </div>
    {% endif %}
</div>

<script>
// Add visual feedback for timeframe selection
document.querySelectorAll('label.card').forEach(label => {
    label.addEventListener('click', function() {
        // Remove highlight from all
        document.querySelectorAll('label.card').forEach(l => {
            l.style.borderColor = 'var(--border-color)';
            l.style.backgroundColor = 'var(--bg-card)';
        });
        // Highlight selected
        this.style.borderColor = 'var(--accent-green)';
        this.style.backgroundColor = 'var(--bg-card-hover)';
    });
});

// Highlight first option by default
document.querySelector('label.card').style.borderColor = 'var(--accent-green)';
document.querySelector('label.card').style.backgroundColor = 'var(--bg-card-hover)';
</script>
{% endblock %}
